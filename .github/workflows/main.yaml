name: 
on:
  push:
    branches:
      - main
env:
  ghSha: ${{ github.sha }}
  ghToken: ${{ secrets.GITHUB_TOKEN }}

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v2
        with:
          fetch-depth: 1
      - name: get tree-sitter cli
        run: | 
            make getTreeSitter 
      - name: generate
        run: |
            echo "TERM=xterm" >> $GITHUB_ENV
            bin/tree-sitter generate
            printf %60s | tr ' ' '-' && echo
            echo 'checks: with "quiet" flag, parse error will fail run'   
            printf %60s | tr ' ' '-' && echo
      - name: 3.1 Primary Expressions
        run: bin/tree-sitter parse examples/primary_expressions.xq --quiet
      - name: 3.2 Postfix Expressions
        run: bin/tree-sitter parse examples/postfix_expressions.xq --quiet
      - name: 3.3 Path Expressions
        run: bin/tree-sitter parse examples/path_expressions.xq --quiet
      - name: 3.4 Sequence Expressions
        run: bin/tree-sitter parse examples/sequence_expressions.xq --quiet
      - name: 3.5 Arithmetic Expressions
        run: bin/tree-sitter parse examples/arithmetic_expressions.xq --quiet
      - name: 3.5 Arithmetic Expressions
        run: bin/tree-sitter parse examples/arithmetic_expressions.xq --quiet
      - name: 3.6 String Concatenation Expressions
        run: bin/tree-sitter parse examples/string_concatenation_expressions.xq --quiet
      - name: 3.7 Comparison Expressions
        run: bin/tree-sitter parse examples/comparison_expressions.xq --quiet
      - name: 3.8 Logical Expressions
        run: bin/tree-sitter parse examples/logical_expressions.xq --quiet
      - name: 3.9 Node Constructors
        run: bin/tree-sitter parse examples/node_constructors.xq --quiet
      - name: 3.10 String Constructors
        run: bin/tree-sitter parse examples/string_constructors.xq --quiet
      - name: 3.11 Maps and Arrays 
        run: bin/tree-sitter parse examples/maps_and_arrays.xq --quiet
      - name: 3.12 FLWOR Expressions 
        run: bin/tree-sitter parse examples/FLWOR_expressions.xq --quiet
      - name: 3.13 Ordered and Unordered Expressions
        run: bin/tree-sitter parse examples/ordered_and_unordered_expressions.xq --quiet
      - name: 3.14 Conditional Expressions
        run: bin/tree-sitter parse examples/conditional_expressions.xq --quiet
      - name: 3.15 Switch Expression
        run: bin/tree-sitter parse examples/switch_expression.xq --quiet
      - name: 3.16 Quantified Expressions
        run: bin/tree-sitter parse examples/quantified_expressions.xq --quiet
      - name: 3.17 Try Catch Expressions
        run: bin/tree-sitter parse examples/try_catch_expressions.xq --quiet
      - name: TODO 3.18 Expressions on SequenceTypes 
        run: bin/tree-sitter parse examples/expressions_on_sequence_types.xq --quiet
      - name: 3.19 Simple map operator 
        run: bin/tree-sitter parse examples/bang.xq --quiet
      - name: 3.19 Simple map operator 
        run: bin/tree-sitter parse examples/bang.xq --quiet
      - name: 3.20 Arrow operator (=>)
        run: bin/tree-sitter parse examples/arrow.xq --quiet
      - name: 4.1 Version Declaration
        run: bin/tree-sitter parse examples/version_declaration.xq --quiet
      - name: 4.16 Variable Declaration
        run: bin/tree-sitter parse examples/variable_declaration.xq --quiet
      # - name: 4.17 Context Item Declaration
      #   run: bin/tree-sitter parse examples/context_item_declaration.xq --quiet
      - name: 4.18 Function Declaration
        run: bin/tree-sitter parse examples/function_declaration.xq --quiet
      - name: 4.19 Option Declaration
        run: bin/tree-sitter parse examples/option_declaration.xq --quiet
      - name: 4.15 Annotations 
        run: bin/tree-sitter parse examples/annotations.xq --quiet
